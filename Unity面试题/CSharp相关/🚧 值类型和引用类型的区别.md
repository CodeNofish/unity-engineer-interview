---
tags:
  - CSharp
  - 性能优化
---


速度上，值类型存取快，引用类型存取慢

用途上，值类型 存储实际数据，引用类型 存储地址

继承关系上，值类型来自System.ValueType，引用类型来自System.Object

位置上，值类型存储在 内存栈中，引用类型的数据 存在堆中、只存地址

传参方式不同，值类型直接值传递，引用传的地址的值

值类型，byte short int long float double decimal char bool 对应的signed struct，
无论是否赋值，都为其分配内存。

引用类型，string class等，一般情况下堆上分配。

---

#### 比较满意的回答

**存储位置与内存管理**
值类型，直接包含数据，独立存在时栈分配，成员存在时 在对象的堆上。
引用类型，实际数据的地址，数据由GC管理，引用也是分情况在堆或者栈上。

**面试官关注点：​**​ 候选人是否清晰区分了变量存储的内容（值 vs 引用）和实际数据的位置（栈 vs 堆）。理解栈和堆的基本特性（速度、生命周期管理）是基础。

​​**赋值与传递行为**
值类型：
赋值传递时，创建完整副本，修改副本不会影响原始值，想修改传参，得加 ref out。
引用类型:
赋值传递时，创建地址的副本。

面试官关注点：​​ 这是最核心的区别之一，也是实际编程中最容易出问题的地方。候选人是否能准确描述赋值和传参时的行为差异？是否能解释 ref/out对引用类型参数传递的影响？

**默认值**
值类型，不能为null，要有默认值。
引用类型，默认为null

面试官关注点：​​ 候选人是否知道值类型不能为 null？理解 null的含义对于避免 NullReferenceException至关重要。

**继承**
值类型，struct enum等 都隐式继承 抽象类ValueType，值类型无法继承只能组合。
引用类型，继承Object。

面试官关注点：​​ 候选人是否知道 struct不能被继承？理解类型系统的基础。

**常见示例**
值类型：基本数据类型 (`int`, `float`, `double`, `bool`, `char`, `byte`等)、`struct`（如 `Vector3`, `Quaternion`, `Color`, `Rect`, `Bounds`等 Unity 常用类型）、`enum`。
引用类型：​​ `class`、`interface`、`delegate`、`string`、`Array`（包括 `int[]`, `GameObject[]`等）、`List<T>`等所有集合类型。

面试官关注点：​​ 候选人是否能举出 Unity 开发中常见的值类型和引用类型例子？特别是 Vector3等常用 struct。

**性能考量**
值类型：
优点，栈分配，GC压力小，缓存局部性好。
缺点，传参赋值大数据拷贝开销大，避免装箱拆箱 产生GC，不支持多态继承OO。
引用类型：
优点，传参赋值高效，支持多态继承OO。
缺点，堆分配GC，在内存在可能不连续 影响缓存效率。
OD和OO之争。
还有C#的Tuple和ValueTuple之争。

unity实践：

优先使用 struct的场景：​​ 小型、不可变或很少修改的数据结构（如坐标、变换信息）。避免在频繁调用的方法（如 Update）中传递大型结构体或导致装箱。

使用 class的场景：​​ 需要继承、多态、表示具有复杂状态或生命周期的实体（如 MonoBehaviour组件、游戏逻辑对象）。

GC 优化：​​ 理解引用类型是 GC 的主要来源。在性能关键代码中（如每帧执行的逻辑），应尽量减少不必要的堆分配（避免在循环中创建新对象、使用对象池、谨慎使用闭包/LINQ 等）。

面试官关注点：​​ ​​这是 Unity 面试的核心！​​ 候选人是否理解值类型和引用类型在性能上的差异？是否了解 GC 对游戏性能的影响？是否能结合 Unity 开发经验（如使用 Vector3vs 自定义类）讨论何时选择 struct或 class？是否知道装箱的危害？是否有关注 GC 优化的意识？

---

#### 后续深入问题

堆栈GC问题

unity常见struct类型

ref out struct问题

Tuple，ValueTuple 

性能问题